### Как жить с квантованием
[ссылка на презентацию](https://docs.google.com/presentation/d/1nS7uMfboUgbiqUW2fpPE0aSncwXekS0nBrndo2Q7pjY/edit?usp=sharing)

Сегодня мы с вами познакомимся с квантованием и quantization aware training на примере торча.
![alt text](le_me.jpg)

Тут как и всегда всё зависит от фреймворка, необходимо внимательно читать доку и в правильном порядке прожимать кнопки.

Я за вас уже прочитал доку и завёл квантование, добавил в код полезных коментариев по поводу 
причины той или иной строчки.

Во время лекции я скорее всего не выдержу и буду ещё и исходники торча показывать. 
При самостоятельном просмотре кода тоже советую посмотреть на исходники и может быть даже посидеть в дебагере.
Особенно обратить внимание на функцию `prepare_fx`.

Что по модулям. 
1. `model` Тут лежит моделька из torchvision. Там добавлена возможность менять фукнцию активации и страйд первого конва.
Не интересно.
2. `tiny_imagenet` Тут датасет и валидация для `tiny imagenet` датасета. Не интересно.
3. `quantization_utils` Тут сам код квантования. `static_quantization.py` это про квантование через калибровку.
`fake_quantization.py` это про quantization aware training.
4. `train_utils.py` Тут код для дистилляции, там больше стандартного кода для трейн лупа.

В корне 3 пускача. `evaluate_non_quantized_model.py` чтобы посмотреть на точность исходной модели и посмотреть на 
пользу фьюзинга.

`evaluate_static_quantized_model.py` чтобы посмотреть на профит от квантования и разочароваться в точности.

`quantization_aware_training.py` чтобы получить надежду на получение исходной точности для квантованной модели.


### Как запустить
1. `week-06` сделать source folder, прокинуть пути или вообще просто вытащить всю папку в отдельный проект.
3. Поставить Pytorch. Я ставлю через [conda](https://pytorch.org/get-started/locally/)
2. `pip install -r requirements.txt`
3. в `resources` запустить tinyimagenet.sh и скачать датасет.
4. В скаченную папку с датасетом закинуть csv с путями для трейна и валидации (`train.csv`, `validation.csv`).
5. Скачать [модель](https://drive.google.com/file/d/1rx93VZ7RvsbxZxWmjCN6y5Mu-2x_h7j8/view?usp=sharing) и кинуть в
`resources`.
6. PROFIT!!!

p.s. Чтобы посмотреть логи тензорборда надо: 
1. `pip install tensorboard`
2. перейти в папку с логом и `tensorboard --logdir=./`
3. в браузере перейти к `localhost:6006`
